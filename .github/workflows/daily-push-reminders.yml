name: Daily Push Reminders

on:
  schedule:
    - cron: "*/30 * * * *"
  workflow_dispatch:

jobs:
  send-reminders:
    runs-on: ubuntu-latest
    env:
      TIMEZONE: America/Los_Angeles
      ONESIGNAL_APP_ID: ${{ secrets.ONESIGNAL_APP_ID }}
      ONESIGNAL_REST_API_KEY: ${{ secrets.ONESIGNAL_REST_API_KEY }}
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Use Node.js
        uses: actions/setup-node@v4
        with:
          node-version: "20"

      - name: Validate OneSignal secrets
        run: |
          if [ -z "${ONESIGNAL_APP_ID}" ]; then
            echo "Missing secret: ONESIGNAL_APP_ID"
            exit 1
          fi
          if [ -z "${ONESIGNAL_REST_API_KEY}" ]; then
            echo "Missing secret: ONESIGNAL_REST_API_KEY"
            exit 1
          fi

      - name: Send reminder if current local time matches
        run: node scripts/send-onesignal-reminder.js
